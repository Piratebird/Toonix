{% extends "base.html" %} {% block title %}Reading Chapter | Toonix{% endblock
%} {% block content %}
<div class="container pt-5 mt-5">
  <div class="text-center mb-4">
    <h4>Chapter Reader</h4>
  </div>

  {% if images %}
  <!-- Download Button -->
  <div class="text-center mb-4">
    <button id="download-btn" class="btn btn-outline-primary">
      Download Chapter
    </button>
  </div>

  <div class="chapter-pages text-center">
    {% for img in images %}
    <img
      src="{{ img }}"
      alt="Page {{ loop.index }}"
      class="img-fluid mb-3"
      style="max-width: 100%"
      loading="lazy"
    />
    {% endfor %}
  </div>

  <script>
    const btn = document.getElementById("download-btn");
    btn.addEventListener("click", async () => {
      btn.disabled = true;
      btn.innerText = "Downloading...";
      try {
        const res = await fetch(
          "{{ url_for('download_chapter', chapter_id=chapter_id) }}"
        );
        const data = await res.json();
        alert(data.message);
      } catch (err) {
        alert("Failed to download chapter.");
      } finally {
        btn.disabled = false;
        btn.innerText = "Download Chapter";
      }
    });
  </script>
  {% else %}
  <p class="text-center">No pages found.</p>
  {% endif %}
</div>
{% endblock %}
